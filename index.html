<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <title>Robocon Visualization</title>
    <!-- Bootstrap -->
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="css/jquery-ui.css" rel="stylesheet">
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>
<style>
    #bot-view {
        height: 40vh;
    }
</style>

<body>
    <div class="container-fluid">

        <!-- Platform controls -->
        <div class="row">
            <div class="col-md-1"></div>
            <div class="col-md-5">
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <h3 class="panel-title">Platform Control</h3>
                    </div>
                    <div class="panel-body">
                        <form>
                            <div class="form-group">
                                <label for="y-axis-value-holder">Y Axis</label>
                                <input type="text" class="form-control" name="y-axis-value-holder" value="90">
                            </div>
                            <div class="form-group">
                                <input type="range" name="y-axis" value="90" min="0" max="180">
                            </div>
                            <div class="form-group">
                                <label for="x-axis-value-holder">X Axis</label>
                                <input type="text" class="form-control" name="x-axis-value-holder" value="90">
                            </div>
                            <div class="form-group">
                                <input type="range" name="x-axis" value="90" min="0" max="180">
                            </div>
                            <div class="form-group">
                                <label for="z-axis-value-holder">Z Axis</label>
                                <input type="text" class="form-control" name="z-axis-value-holder" value="90">
                            </div>
                            <div class="form-group">
                                <input type="range" name="z-axis" value="90" min="0" max="180">
                            </div>
                        </form>
                        <form>
                            <div class="form-group">
                                <label for="servo-one-value-holder">Servo One</label>
                                <input type="text" class="form-control" name="servo-one-value-holder" value="90">
                            </div>
                            <div class="form-group">
                                <input type="range" name="servo-one" value="90" min="0" max="180">
                            </div>
                            <div class="form-group">
                                <label for="servo-two-value-holder">Servo Two</label>
                                <input type="text" class="form-control" name="servo-two-value-holder" value="90">
                            </div>
                            <div class="form-group">
                                <input type="range" name="servo-two" value="90" min="0" max="180">
                            </div>
                            <div class="form-group">
                                <label for="servo-three-value-holder">Servo Three</label>
                                <input type="text" class="form-control" name="servo-three-value-holder" value="90">
                            </div>
                            <div class="form-group">
                                <input type="range" name="servo-three" value="90" min="0" max="180">
                            </div>
                        </form>
                    </div>
                </div>
            </div>
            <div class="col-md-5" id="bot-view"></div>
            <div class="col-md-1"></div>
        </div>
        <!-- / Platform controls row -->

        <!-- Motor controls -->
        <div class="row">
            <div class="col-md-1"></div>
            <div class="col-md-10">
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <h3 class="panel-title">Drive Controls</h3>
                    </div>
                    <div class="panel-body">

                        <form>
                            <div class="form-group">
                                <div class="form-group">
                                    <label for="z-axis-value-holder">Motor Speed Controls</label>
                                    <div class="input-group">
                                        <input type="text" class="form-control" placeholder="Speed.." name="drive-speed-input">
                                        <span class="input-group-btn">
                        <button class="btn btn-default" type="button" id="drive-speed-button">Set</button>
                      </span>
                                    </div>
                                    <!-- /input-group -->
                                    <div class="form-group"></div>
                                    <input type="range" name="drive-speed-range" value="0" min="0" max="255">
                                </div>
                            </div>
                        </form>
                        <div class="btn-group btn-group-justified" role="group" aria-label="...">
                            <div class="btn-group" role="group">
                                <button type="button" class="btn btn-default">Stop</button>
                            </div>
                            <div class="btn-group" role="group">
                                <button type="button" class="btn btn-default">Forward</button>
                            </div>
                            <div class="btn-group" role="group">
                                <button type="button" class="btn btn-default">Backward</button>
                            </div>
                            <div class="btn-group" role="group">
                                <button type="button" class="btn btn-default" id="self-mode">Self Mode</button>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
            <div class="col-md-1"></div>
        </div>
        <!-- / Platform controls Row -->

    </div>
    <!-- / Container fluid -->


    <script src="js/jquery.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/jquery-ui.js"></script>
    <script src="js/three.js"></script>
    <script src="js/OrbitControls.js"></script>
    <script src="js/TransformControls.js"></script>
    <script src="js/socket.io-1.4.5.js"></script>


    <script>
        var socket = io('http://192.168.12.248:8888');

        $(document).ready(function() {
            // Y Axis
            $('input[name=y-axis]').on('change', function() {
                data = {
                    yaxis: $('input[name=y-axis]').val()
                };
                socket.emit('yaxis', data);
            });
            $('input[name=y-axis]').on('input', function() {
                $('input[name=y-axis-value-holder]').val($('input[name=y-axis]').val());
                cube.rotation.y = ($('input[name=y-axis]').val() * (3.14 / 180)) - (90 * (3.14 / 180));
                render();
            });


            // X Axis
            $('input[name=x-axis]').on('change', function() {
                data = {
                    xaxis: $('input[name=x-axis]').val()
                };
                socket.emit('xaxis', data);
            });
            $('input[name=x-axis]').on('input', function() {
                $('input[name=x-axis-value-holder]').val($('input[name=x-axis]').val());
                cube.rotation.x = ($('input[name=x-axis]').val() * (3.14 / 180)) - (90 * (3.14 / 180));
                render();
            });


            // Z Axis
            $('input[name=z-axis]').on('change', function() {
                data = {
                    zaxis: $('input[name=z-axis]').val()
                };
                socket.emit('zaxis', data);
            });
            $('input[name=z-axis]').on('input', function() {
                $('input[name=z-axis-value-holder]').val($('input[name=z-axis]').val());
                cube.rotation.z = ($('input[name=z-axis]').val() * (3.14 / 180)) - (90 * (3.14 / 180));
                render();
            });


            // Servo one
            $('input[name=servo-one]').on('change', function() {
                data = {
                    value: $('input[name=servo-one]').val()
                };
                socket.emit('servo one', data);
            });
            $('input[name=servo-one]').on('input', function() {
                $('input[name=servo-one-value-holder]').val($('input[name=servo-one]').val());
            });

            // Servo two
            $('input[name=servo-two]').on('change', function() {
                data = {
                    value: $('input[name=servo-two]').val()
                };
                socket.emit('servo two', data);
            });
            $('input[name=servo-two]').on('input', function() {
                $('input[name=servo-two-value-holder]').val($('input[name=servo-two]').val());
            });

            // Servo three
            $('input[name=servo-three]').on('change', function() {
                data = {
                    value: $('input[name=servo-three]').val()
                };
                socket.emit('servo three', data);
            });
            $('input[name=servo-three]').on('input', function() {
                $('input[name=servo-three-value-holder]').val($('input[name=servo-three]').val());
            });


            //Drive Speed
            $('input[name=drive-speed-range]').on('input', function() {
                $('input[name=drive-speed-input]').val($('input[name=drive-speed-range]').val());
            });
            $('#drive-speed-button').click(function() {
                $('input[name=drive-speed-range]').val($('input[name=drive-speed-input]').val());
                data = {
                    value: $('input[name=drive-speed-range]').val()
                };
                socket.emit('drive speed', data);
            });
            $('input[name=drive-speed-range]').on('change', function() {
                data = {
                    value: $('input[name=drive-speed-range]').val()
                };
                socket.emit('drive speed', data);
            });

            // Self Mode
            $("#self-mode").click(function() {
                console.log("Self Mode Enbaled");
            });
            $("#self-mode").keydown(function(e) {
                if (e.keyCode == '38') {
                    selfMode(38);
                    // console.log("up");
                } else if (e.keyCode == '40') {
                    selfMode(40);
                    // console.log("down");
                } else if (e.keyCode == '37') {
                    selfMode(37);
                    // console.log("left");
                } else if (e.keyCode == '39') {
                    selfMode(39);
                    // console.log("right");
                }
                e.preventDefault(); // prevent the default action (scroll / move caret)
            });
            $("#self-mode").keyup(function(e) {
                e.preventDefault(); // prevent the default action (scroll / move caret)
                // console.log("stop");
                selfMode(0);
            });
            var lastDirection = 0;
            function selfMode(direction) {
                if (lastDirection != direction) {
                    lastDirection = direction;
                    console.log(direction);
                    data = {
                        value: direction
                    };
                    socket.emit('self mode direction', data);
                }
            }

        });

        socket.on('position', function (data) {
          pitch = data.pitch
          yaw = data.yaw
          roll = data.roll
        })

        var scene, camera, rendered, control, cube, controls;
        init();
        animate();

        function init() {
            scene = new THREE.Scene();
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);

            renderer = new THREE.WebGLRenderer();
            renderer.setSize($("#bot-view").width(), $("#bot-view").height());
            container = document.getElementById('bot-view');
            container.appendChild(renderer.domElement);

            var geometry = new THREE.BoxGeometry(5, 1, 10);
            var material = new THREE.MeshBasicMaterial({
                color: 0x00ff00
            });
            cube = new THREE.Mesh(geometry, material);
            scene.add(cube);

            // var size = 10;
            // var divisions = 10;
            // var gridHelper = new THREE.GridHelper( size, divisions );
            // scene.add( gridHelper );

            // PolarGridHelper
            var radius = 10;
            var radials = 16;
            var circles = 8;
            var divisions = 64;

            var helper = new THREE.PolarGridHelper(radius, radials, circles, divisions);
            scene.add(helper);

            var axisHelper = new THREE.AxisHelper(20);
            scene.add(axisHelper);

            camera.position.x = 20;
            camera.position.y = 20;
            camera.position.z = 20;

            controls = new THREE.OrbitControls(camera, container);
            controls.enabled = false;
            controls.addEventListener('change', render);
            // control = new THREE.TransformControls( camera, renderer.domElement );
            // control.addEventListener( 'change', render );
            // control.attach( cube );
            // scene.add( control );
            // control.setMode( "rotate" );
        }

        function animate() {
            requestAnimationFrame(animate);
            controls.update();
        }

        function render() {
          // requestAnimationFrame( render )
          cube.rotation.x = roll
          cube.rotation.y = yaw
          cube.rotation.z = pitch
          renderer.render(scene, camera);
        }

        render();
    </script>
</body>

</html>
